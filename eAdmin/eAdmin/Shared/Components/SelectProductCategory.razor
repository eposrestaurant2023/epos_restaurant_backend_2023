
<div class="uk-margin-small">
    <label class="uk-form-label" for="@id">
        @if (line_icon != "")
        {
            <LineIcon IconName="@line_icon" />
        }
        else if (icon != "")
        {

            <Icon icon="@icon" />
        }
        @label
    </label>
    <div class="uk-form-controls">
        @if (is_readonly)
        {
            <select id="@id" value="@SelectedValue" @onchange="@((ui) => SelectedValueChange((String)ui.Value))" class="uk-select uk-form-small @width" disabled>
                @if (show_empty)
                {
                    <option value="0">@empty_text</option>
                }

                @if (is_ingredient_category)
                {
                    foreach (var p in gv.product_categories.Where(r => r.is_deleted == false && r.is_deleted_group == false && r.status_group == true && r.is_ingredient_category == true))
                    {
                        <option value="@p.id">@p.product_category_en</option>
                    }
                }
                else
                {
                    foreach (var p in gv.product_categories.Where(r => r.is_deleted == false && r.is_deleted_group == false && r.status_group == true && r.is_ingredient_category == false))
                    {
                        <option value="@p.id">@p.product_category_en</option>
                    }
                }
            </select>
        }
        else
        {
            if (product_category != null)
            {
                <div>ddddf</div>
                if (!gv.product_categories.Where(r => r.is_deleted == false && r.is_ingredient_category == true && r.is_deleted_group == false && r.status_group == true && r.id == product_category.id).Any())
                {
                    <div class="uk-alert-warning" uk-alert>
                        <span class="uk-text-small uk-text-italic">It's category was deleted or close status. You can change category to choose category below.</span>
                    </div>
                }
            }

            <select id="@id" value="@SelectedValue" @onchange="@((ui) => SelectedValueChange((String)ui.Value))" class="uk-select uk-form-small @width">
                @if (show_empty)
                {
                    <option value="0">@empty_text</option>
                }
                @if (is_ingredient_category)
                {
                    foreach (var p in gv.product_categories.Where(r => r.is_deleted == false && r.is_ingredient_category == true && r.is_deleted_group == false && r.status_group == true))
                    {
                        <option value="@p.id">@p.product_category_en</option>
                    }
                }
                else
                {
                    foreach (var p in gv.product_categories.Where(r => r.is_deleted == false && r.is_ingredient_category == false && r.is_deleted_group == false && r.status_group == true))
                    {
                        <option value="@p.id">@p.product_category_en</option>
                    }
                }
            </select>
        }

        @ChildContent
    </div>
            </div>

@code{
    [CascadingParameter] public GlobalVariableModel gv { get; set; }
    [Parameter] public string line_icon { get; set; } = "";
    [Parameter] public string icon { get; set; } = "";
    [Parameter] public bool is_ingredient_category { get; set; } = false;
    [Parameter] public int selected_value { get; set; }
    [Parameter] public ProductCategoryModel product_category { get; set; }
    [Parameter] public bool show_empty { get; set; } = false;
    [Parameter] public bool is_readonly { get; set; } = false;
    [Parameter] public string empty_text { get; set; } = "Select Product Category";
    [Parameter] public int empty_value { get; set; }
    [Parameter] public string label { get; set; } = "Product Category";
    [Parameter] public string width { get; set; } = "";
    [Parameter] public RenderFragment ChildContent { get; set; }

    [Parameter] public EventCallback<int> selected_valueChanged { get; set; }
    [Parameter] public EventCallback<ProductCategoryModel> product_categoryChanged { get; set; }

    Guid id = Guid.NewGuid();





    public int SelectedValue
    {
        get
        {
            return product_category == null ? selected_value : product_category.id;
        }
    }

    private async Task SelectedValueChange(string n)
    {
        selected_value = Int32.Parse(n);
        await selected_valueChanged.InvokeAsync(selected_value);
        if (selected_value == 0)
        {
            await product_categoryChanged.InvokeAsync(new ProductCategoryModel());
        }
        else
        {
            await product_categoryChanged.InvokeAsync(gv.product_categories.Where(r => r.id == selected_value).FirstOrDefault());
        }

    }
}
