@inherits LayoutBase
@inject IStringLocalizer<Resource> lang
<MudThemeProvider Theme="MyCustomTheme"  />
<MudDialogProvider />
<MudSnackbarProvider />

<AuthorizeView>
    <Authorized>
        @if (!IsLoading)
        {
        <CascadingValue Value="gv">
            @if (!string.IsNullOrEmpty(gv.project_id))
            {
            <MudLayout>
                <MudAppBar Elevation="25">
                    <MudHidden Breakpoint="Breakpoint.MdAndUp">
                        <MudIconButton Icon="@Icons.Material.Outlined.Menu" Color="MudBlazor.Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
                    </MudHidden>
                    <MudHidden Breakpoint="Breakpoint.SmAndDown">
                        <a href="dashboard">
                            <Image ImageUrl="images/ePOS-Res.png" Width="100px" />
                        </a>
                    </MudHidden>

                    <MudHidden Breakpoint="Breakpoint.SmAndDown">
                        <MudText Style="color:#FFFFFF" Typo="Typo.h6" Class="ml-4">@gv.business_info?.company_name</MudText>
                    </MudHidden>

                    <MudSpacer />
                    <GlobalSearch />
                    <MudSpacer />
                    <MudHidden Breakpoint="Breakpoint.SmAndDown">
                        <MudIconButton Color="MudBlazor.Color.Inherit" Icon="@Icons.Material.Filled.AttachMoney" Title="@lang["Exchange Rate"]" OnClick="@(()=>nav.NavigateTo("currencyexchangerate"))"></MudIconButton>
                        @if (is_spinner)
                        {
                            <Spinner />
                        }
                        else
                        {
                            <MudIconButton Color="MudBlazor.Color.Inherit" Icon="@Icons.Material.Filled.Refresh" Title="@lang["Refresh"]" OnClick="@(async () => await LoadData())"></MudIconButton>
                        }
                        <ComQuickAddMenu />
                    </MudHidden>
                    <LoginDisplay />
                </MudAppBar>
                <MudDrawer @bind-Open="_drawerOpen" Elevation="25" ClipMode="DrawerClipMode.Always">
                    <div style="padding-bottom: 20px;">
                        <NavMenu />
                    </div>
                </MudDrawer>
                <MudMainContent>
                    <ComSystemExpiredAlert />
                    @Body
                </MudMainContent>

            </MudLayout>
               
            }
            else
            {
                <Redirect url="login" />
            }
        </CascadingValue>
        }
    </Authorized>
    <NotAuthorized>
        <Redirect url="login" />
    </NotAuthorized>
</AuthorizeView>

 