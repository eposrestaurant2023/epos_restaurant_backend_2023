@page "/role/permission/{role_id:int}"
@inherits PageCore

<PageContainer roles="@gv.GetRole("role_manager")">
    <PageHeader>
        <HeaderLeft>
            <PageTitle ShowFilter="false">
                <HeaderTemplate>
                    <span>@*@((id > 0)? "Edit Role" : "New Role")*@</span>
                </HeaderTemplate>
            </PageTitle>
        </HeaderLeft>
        <HeaderRight ShowBackButton="true">
        </HeaderRight>
    </PageHeader>
    <!--<EditForm Model="@model" OnValidSubmit="@SaveRole_Click">
        <DataAnnotationsValidator />
        <PageBody>
            <Spacing Number="20" />
            <div class="uk-grid-small" uk-grid>
                <div class="uk-width-1-3">
                    <div class="report-item">
                        <div class="report-header">
                            Front End
                        </div>
                        <div class="report-content">
                            @foreach (var fn in permissionoption.Where(r => r.is_front_end == true).ToList())
                            {
                                <div class="cus_margin">
                                    <ComInputCheckBox label="@fn.note" label_inline="true" @bind-value="fn.is_checked" />
                                </div>
                            }
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-3">
                    <div class="report-item">
                        <div class="report-header">
                            Back End
                        </div>
                        <div>
                            <ComPerMissionOptionTree parent_id="null" PermissionOptions="@permissionoption" />
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-3">
                    <div class="report-item">
                        <div class="report-header">
                            Report
                        </div>
                        <div class="report-content">-->

                            @*<ComPerMissionOptionTree parent_id="44" PermissionOptions="@permissionoption.Where(r=>r.is_report==true).ToList()"/>*@
                        <!--</div>
                    </div>
                </div>
            </div>

        </PageBody>
    </EditForm>-->
</PageContainer>

@code {
    [Parameter] public int role_id { get; set; }
    List<PermissionOptionModel> permissionoption = new List<PermissionOptionModel>();
    protected override async Task OnInitializedAsync()
    {
        is_loading = true;
        await LoadData();
        is_loading = false;
    }

    async Task LoadData()
    {
        is_loading_data = true;
        var resp = await http.ApiGetOData("PermissionOption?$expand=permission_option_roles($select=permission_option_id,role_id,is_delete");
        if (resp.IsSuccess)
        {
            permissionoption = JsonSerializer.Deserialize<List<PermissionOptionModel>>(resp.Content.ToString());
        }
        is_loading_data = false;
    }
}
