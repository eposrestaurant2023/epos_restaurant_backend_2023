@page "/receiptlist"
@inherits PageReceiptListBase

<Loading is_loading="@(is_loading || is_loading_data)" />

@{
    RenderFragment HeaderTemplate(string field_name, string display_name, string ClassName = "") =>
    @<Th OnClick="@(async () => await OrderBy(field_name))" OrderBy="@(state.pager.order_by == field_name)" OrderByType="@state.pager.order_by_type" ClassName="@($"cp {ClassName}")"> @display_name</Th>;
}

@if (!is_loading)
{
    <Title Value="Sale" ></Title>  
    <PageContainer>
        <PageHeader>
            <HeaderLeft>
                <PageTitle ShowFilter="false">
                    <HeaderTemplate>
                        @state.page_title
                    </HeaderTemplate>
                </PageTitle>
            </HeaderLeft>
            <HeaderRight> 
                <RefreshButton OnClick="@(async()=>await LoadData())" />
                <ComSearch place_holder="@GetFilterValue2(state.filters, "keyword","")" KeywordChanged="@OnSearch" show_advance_filter="true" OnFillterClick="@FilterClick">
                    <FilterDateRange @bind-dates="@state.date_range" />
                    <MultipleSelect label="Business Branch" @bind-selected_values="@multi_select" select_options="@gv.bussiness_branches.Select(r=>r.business_branch_name_en).ToList()" />
                    <div class="uk-alert" style="word-break:break-word">
                        @JsonSerializer.Serialize(gv.bussiness_branches.Select(r => r.business_branch_name_en).ToList());
                                    </div>
                    <div class="uk-form-controls" style="margin-bottom: 10px;">
                        <label sclass="uk-form-label">Customer</label>
                        @*<CustomerTypeahead @bind-customer="@state.customer" />*@
                    </div>
                </ComSearch>
            </HeaderRight>
        </PageHeader>
        <PageBody>
            <div style="word-break:break-word">@ControllerApi</div>
            <Com is_visible="@(models != null)">
                <Table Items="@models"
                       PerPage="@state.pager.per_page"
                       TotalItem="@TotalRecord"
                       CurrentPage="@state.pager.current_page"
                       OnPagerChange="@SelectChange"
                       OnPageChange="@ChangePager"
                       isLoading="@is_loading_data"
                       ShowPager="true"
                       ShowCounter="true"
                       ClassName="uk-table-small uk-table-striped uk-table-hover"
                       ScrollClass="uk-overflow-auto"
                       EmptyText="There is no record.">
                    <TableHeader>
                        @HeaderTemplate("sale_date", "Sale Date", "uk-text-center")
                        @HeaderTemplate("document_number", "Document#", "uk-text-center")
                        @HeaderTemplate("referance_number", "Referance#", "uk-text-center")
                        @HeaderTemplate("customer/customer_name", "Customer", "col-auto")
                        @HeaderTemplate("outlet/outlet_name_en", "Outlet")
                        @HeaderTemplate("business_branch/business_branch_name_en", "Business Branch")
                        <ThRight>Total Amount</ThRight>
                        <ThRight>Paid Amount</ThRight>
                        <ThRight>Balance</ThRight>
                        <ThCenter>Status</ThCenter>
                        <th class="uk-width-auto"></th>
                    </TableHeader>
                    <RowTemplate Context="p">
                        <TdCenter>@p.sale_date.ToString(gv.date_format)</TdCenter>
                        <TdCenter>
                            <div><a href="@($"sale/{p.id}")">@p.document_number</a></div>
                        </TdCenter>
                        <TdCenter>@p.reference_number</TdCenter>
                        <td>
                            <a href="@($"customer/{p.customer_id}")">
                                <ComCustomerInfo customer="p.customer" />
                            </a>
                        </td>
                        <td>
                            @p.outlet?.business_branch?.business_branch_name_en
                        </td>
                        <td>
                            @p.outlet?.outlet_name_en
                        </td>
                        <TdRight>
                            @p.total_amount.ToString(gv.main_currency_format)
                        </TdRight>
                        <TdRight>
                            @p.paid_amount.ToString(gv.main_currency_format)
                        </TdRight>
                        <TdRight>
                            @p.balance.ToString(gv.main_currency_format)
                        </TdRight>
                        <TdRight>
                            <ComSaleStatus sale="@p" />
                        </TdRight>
                        <TdCenter>
                            <Icon icon="visibility" OnClick="@(()=>nav.NavigateTo($"receiptlist/{p.id}"))" />
                        </TdCenter>
                    </RowTemplate>
                </Table>
            </Com>
        </PageBody>
    </PageContainer> 
}