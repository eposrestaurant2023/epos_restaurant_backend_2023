@inherits POProductHistoryBase

<Loading is_loading="@(is_loading || is_loading_data)" />

@{
    RenderFragment HeaderTemplate(string field_name, string display_name, string ClassName = "") =>
    @<Th OnClick="@(async () => await OrderBy(field_name))" OrderBy="@(state.pager.order_by == field_name)" OrderByType="@state.pager.order_by_type" ClassName="@($"cp {ClassName}")"> @display_name</Th>;
}

@if (!is_loading)
{
    <PageContainer is_container="false">
        <PageHeader is_subpage="true">
            <HeaderLeft>
                <PageTitle ShowFilter="false">
                    <HeaderTemplate>@state.page_title</HeaderTemplate>
                </PageTitle>
            </HeaderLeft>
            <HeaderRight>
                <RefreshButton OnClick="@(async()=>await LoadData())" />
                <ComSearch place_holder="@GetFilterValue2(state.filters, "keyword","")" KeywordChanged="@OnSearch" show_advance_filter="true" OnFillterClick="@FilterClick">
                    <FilterDateRange @bind-dates="@state.date_range" />
                    <SelectBusinessBranchMutiple selected_business="@state.multi_select_id_1" selected_businessChanged="@((val)=> { state.multi_select_id_1 = val;state.multi_select_id_2= null;  } )" business_id="@((val)=>state.multi_select_value_1=val)" />
                    <SelectStockLocationMultiple business_branch_ids="@state.multi_select_value_1" @bind-selected_stock_location="@state.multi_select_id_2" stock_location_id="@((val)=>state.multi_select_value_2=val)" />
                </ComSearch>
            </HeaderRight>
        </PageHeader>
        <PageBody>
            @ControllerApi
            <FilterInfo filters="@state.filters" OnRemoveFilterClick="@RemoveFilter" OnRemoveAllFilterClick="@RemoveAllFilter" />

            <Com is_visible="@(models != null)">

                <Table Items="@models"
                       PerPage="@state.pager.per_page"
                       TotalItem="@TotalRecord"
                       CurrentPage="@state.pager.current_page"
                       OnPagerChange="@SelectChange"
                       OnPageChange="@ChangePager"
                       isLoading="@is_loading"
                       ShowPager="true"
                       ShowCounter="true"
                       ClassName="uk-table-small uk-table-striped uk-table-hover"
                       ScrollClass="uk-overflow-auto"
                       EmptyText="There is no record.">
                    <TableHeader>
                        @HeaderTemplate("sale_date", "Date", "uk-text-center")
                        @HeaderTemplate("document_number", "Document#", "uk-text-center")
                        @HeaderTemplate("product/product_name", "Product", "col-auto")
                        <ThCenter>Quantity</ThCenter>
                        <ThRight>Price</ThRight>
                        <ThRight>Discount</ThRight>
                        <ThRight>Amount</ThRight>
                        <ThCenter>Created Date</ThCenter>
                        <Th>Created By</Th>
                        <ThCenter>Status</ThCenter>
                        <th class="uk-width-auto"></th>
                    </TableHeader>
                    <RowTemplate Context="p">

                        <TdCenter>@p.purchase_order?.purchase_date.ToString(gv.date_format)</TdCenter>

                        <TdCenter>
                            <ComAuthorize roles="@gv.GetRole("sale_view")" url="@($"sale/{p.purchase_order_id}")">@p.purchase_order?.document_number</ComAuthorize>
                        </TdCenter>
                        <td>
                            <ComAuthorize roles="@gv.GetRole("product_view")" url="@($"product/{p.product_id}")">@p.product?.product_name_en</ComAuthorize>
                        </td>
                        <TdCenter>
                            <span>@p.quantity.ToString(gv.quantity_format)</span>
                        </TdCenter>
                        <TdRight>
                            @p.selling_price.ToString(gv.main_currency_format)
                        </TdRight>
                        <TdRight>
                            @p.total_discount.ToString(gv.main_currency_format)
                        </TdRight>
                        <TdRight>
                            @p.total_amount.ToString(gv.main_currency_format)
                        </TdRight>
                        <TdCenter>@p.created_date.ToString(gv.date_time_format)</TdCenter>
                        <td>@p.created_by</td>
                        <TdRight>
                            <LabelDeleted is_visible="@(p.is_deleted)" />
                        </TdRight>
                        <TdCenter>
                            <TdActions is_loading="@p.is_loading">
                                <TableActionItem roles="@gv.GetRole("purchase_order_management")" icon="visibility" url="@($"purchaseorder/{p.id}")">View</TableActionItem>
                                <TableActionItem roles="@gv.GetRole("purchase_order_edit")" icon="edit" url="@($"purchaseorder/edit/{p.id}")">Edit</TableActionItem>
                            </TdActions>
                        </TdCenter>
                    </RowTemplate>
                </Table>


            </Com>

        </PageBody>
    </PageContainer> 
}