@page "/purchaseorder/{id:int}";
@inherits PagePurchaseOrderDetailBase


<Loading is_loading="@( is_loading || is_loading_data)" />



@if (!is_loading)
{
    <Title Value="@($"{lang["Purchase Order #"]} : {model.document_number}")"></Title>

    <PageContainer roles="@gv.GetRole("purchase_order_management")">
        <PageHeader>
            <HeaderLeft>
                <PageTitle ShowFilter="false">
                    <HeaderTemplate>
                        @lang["Purchase Order #"] : @model.document_number
                        <LabelDeleted is_visible="@model.is_deleted" />
                        <ComPurchaseOrderStatus po="@model" />
                    </HeaderTemplate>
                </PageTitle>
            </HeaderLeft>
            <HeaderRight ShowBackButton="true">
                <ComPurchaseOrderDetail_ActionButton @bind-po="@model" OnAddPayment="@(()=>is_add_payment=true)" OnRefresh="@OnRefresh"/>
            </HeaderRight>
        </PageHeader>
        <PageBody>
            <MudTabs PanelClass="pa-6">
                    <MudTabPanel Text="@lang["Purchase Order"]">
                        <ComMarkInvoiceFulfilled is_visible="@(!model.is_fulfilled)" OnClick="@MarkAsFulfilled" message="@(lang["You can mark this purchase order as Fulfilled"])" />
                        <ComPage>
                            <ComPurchaseOrderDetail_InvoiceHeader po="@model" />
                            <Spacing Number="20" />
                            <table class="view_table uk-table uk-table-small uk-table-divider table-bordered">
                                <thead>
                                    <tr>
                                        <th>@lang["No"]</th>
                                        <ThCenter>@lang["Image"]</ThCenter>
                                        <th class="col-auto">@lang["Description"]</th>
                                        <th class="uk-text-center">@lang["QTY"]</th>
                                        <th class="uk-text-right">@lang["Price"]</th>
                                        <th class="uk-text-right">@lang["Dis."]</th>
                                        <th class="uk-text-right">@lang["Amount"]</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ComPurchaseOrderDetail_InvoiceBody po="@model" />
                                </tbody>
                                <tfoot>
                                    <ComPurchaseOrderDetail_InvoiceFooter po="@model" />
                                </tfoot>
                            </table>
                            <Spacing Number="20" />
                            <ComPurchaseOrderDetail_PONote po="@model" />
                            <ComPurchaseOrderDetail_FooterInformation po="@model" />
                        </ComPage>
                    </MudTabPanel>
                <MudTabPanel OnClick="@ShowPaymentHistory" Text="@lang["Payment"]">
                    @if (is_show_payment_history)
                    {
                        <ComPurchaseOrderDetail_PaymentList po="@model" on_reload="LoadData" />
                    }
                </MudTabPanel>
                <MudTabPanel OnClick="@ShowComment" Text="@lang["Comment and History"]">
                    @if (is_show_comment)
                    {
                        <ComHistory RoleAdd="@gv.GetRole("purchase_order_add")"
                                    RoleDelete="@gv.GetRole("purchase_order_delete")"
                                    RoleEdit="@gv.GetRole("purchase_order_edit")"
                                    ApiFilter="@($"purchase_order_id  eq {id}")"
                                    history="@history" />

                    }
                </MudTabPanel>
            </MudTabs>
            <div class="spacing40"></div>
        </PageBody>
    </PageContainer>

}

@if (is_error)
{
    <Error title="@lang["Purchase Order Detail"]">
        @error_text
    </Error>
}


@if (is_add_payment)
{
    <ComPurchaseOrderDetail_AddPayment po="@model" id="0" @bind-is_opened="@is_add_payment" payment_id="@payment_id" OnSave="@OnSavePayment" />
}
