@page "/customer/{id}"
@inherits PageCustomerDetails
<Loading is_loading="@(is_loading || is_loading_data)" />
@if (!is_loading && !is_error)
{
    <Title Value="@($"Customer | {model.customer_code_name}")"></Title>
    <PageContainer roles="@gv.GetRole("customer_management")">
        <PageHeader>
            <HeaderLeft>
                <PageTitle ShowFilter="false">
                    <HeaderTemplate>
                        @model.customer_code_name 
                        <LabelDeleted is_visible="@model.is_deleted" />
                        <LabelActive is_visible="@(!model.is_deleted && model.status)" />
                        <LabelInActive is_visible="@(!model.is_deleted && !model.status)" />
                    </HeaderTemplate>
                </PageTitle>
            </HeaderLeft>
            <HeaderRight ShowBackButton="true">
                <MudHidden Breakpoint="Breakpoint.SmAndDown">
                    <Button icon="edit" title="@lang["Edit"]" OnClick="@(()=>nav.NavigateTo($"customer/edit/{model.id}"))" is_visible="@(!model.is_deleted)" />
                    <SplitButton OnClick="@(()=>nav.NavigateTo("customer/new"))" main_button_text="@lang["New"]">
                        <SplitButtonItem roles="@gv.GetRole("customer_add")" OnClick="@(()=>nav.NavigateTo("customer/new"))">@lang["New Customer"]</SplitButtonItem>
                    </SplitButton>
                </MudHidden>
                <RefreshButton OnClick="@LoadData" />
                <MoreButton is_loading="@model.is_loading">
                    <MudHidden Breakpoint="Breakpoint.MdAndUp">
                        <MoreButtonItem roles="@gv.GetRole("customer_add")" icon="add" url="customer/new">@lang["New Customer"]</MoreButtonItem>
                        <MoreButtonItem roles="@gv.GetRole("customer_edit")" icon="edit" OnClick="@(()=>nav.NavigateTo($"customer/edit/{model.id}"))">@lang["Edit"]</MoreButtonItem>
                    </MudHidden>
                    <MoreButtonItem roles="@gv.GetRole("customer_add")" icon="file_copy" url="@($"customer/clone/{model.id}")">@lang["Clone"]</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_edit")" icon="highlight_off" is_visible="@(!model.is_deleted && model.status)" OnClick="@(() => OnToogleStatus(model))">@lang["Inactive"]</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_edit")" icon="check" is_visible="@(!model.is_deleted && !model.status)" OnClick="@(() => OnToogleStatus(model))">@lang["Active"]</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_delete")" icon="delete" is_visible="@(!model.is_deleted)" OnClick="@(() => OnDelete(model))">@lang["Delete"]</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_restore")" icon="refresh" is_visible="@(model.is_deleted)" OnClick="@(() => OnRestore(model))">@lang["Restore"]</MoreButtonItem>

                </MoreButton>
            </HeaderRight>
        </PageHeader>
        <PageBody>
            <MudTabs PanelClass="pa-6">
                    <MudTabPanel Text="@lang["Overview"]">
                        <ComCustomerDetail_CustomerInformation model="@model" />
                    </MudTabPanel>
                <MudTabPanel OnClick="@(()=>sale_history_tab_click=true)" Text="@lang["Sale History"]">
                    @if (sale_history_tab_click)
                    {
                        <ComCustomerSaleHistory customer_id="@Guid.Parse(id)" />
                    }
                </MudTabPanel>
                <MudTabPanel OnClick="@(()=>sale_product_history_tab_click = true)" Text="@lang["Sale Product History"]">
                    @if (sale_product_history_tab_click)
                    {
                        <ComCustomerSaleProductHistory customer_id="@Guid.Parse(id)" />
                    }
                </MudTabPanel>
                <MudTabPanel OnClick="@(()=>show_payment = true)" Text="@lang["Sale Payment History"]">
                    @if (show_payment)
                    {
                        <ComCustomerPaymentHistory customer_id="@Guid.Parse(id)" />
                    }
                </MudTabPanel>
                <MudTabPanel OnClick="@(()=> is_comment_loaded = true)" Text="@lang["Comments"]">
                    <Com is_visible="@is_comment_loaded">
                        <ComHistory RoleAdd="@gv.GetRole("customer_add")"
                                    RoleDelete="@gv.GetRole("customer_delete")"
                                    RoleEdit="@gv.GetRole("customer_edit")"
                                    ApiFilter="@($"customer_id eq {id}")"
                                    history="@(new HistoryModel() { customer_id = Guid.Parse(id)})"
                                    OnSave="@SaveComment" />
                    </Com>
                </MudTabPanel>
            </MudTabs>
        </PageBody>
    </PageContainer>
}
@if (is_error)
{
    <Error title="@lang["Customer Detail"]">
        @error_text
    </Error>
}

