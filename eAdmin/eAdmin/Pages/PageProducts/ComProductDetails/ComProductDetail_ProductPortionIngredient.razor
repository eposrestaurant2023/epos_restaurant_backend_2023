@inject IHttpService http
@inject IMatToaster toast
<UIGridCenter>
    @if (is_loading)
    {
        <Spinner />
    }
    else
    {
        @foreach (var pp in product_potions)
        {
            <ComProductDetail_Ingredients product_portion="@pp" />
        }
    }

</UIGridCenter>

@code {
    [CascadingParameter] public GlobalVariableModel gv { get; set; }
    [Parameter] public int product_id { get; set; }
    List<ProductPortionModel> product_potions = new List<ProductPortionModel>();
    
    
    bool is_loading;

   

    protected override async Task OnInitializedAsync()
    {

        is_loading = true;
        await LoadData();
        is_loading = false;
    }

    public async Task LoadData()
    {
        is_loading = true;

        if (product_id > 0)
        {
            var resp = await http.ApiGetOData($"ProductPortion?$expand=product_ingredients($expand=ingredient($select=id,product_code,product_name_en,product_name_kh),unit($select=id,unit_name))&$filter=product_id eq {product_id}");
            if (resp.IsSuccess)
            {
                product_potions = JsonSerializer.Deserialize<List<ProductPortionModel>>(resp.Content.ToString());
            }
        }
        is_loading = false;
    }

   


}
