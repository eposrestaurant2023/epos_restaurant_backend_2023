@inherits StockStransferProductDetailHistoryBase

<Loading is_loading="@(is_loading || is_loading_data)" />

@{
    RenderFragment HeaderTemplate(string field_name, string display_name, string ClassName = "") =>
    @<Th OnClick="@(async () => await OrderBy(field_name))" OrderBy="@(state.pager.order_by == field_name)" OrderByType="@state.pager.order_by_type" ClassName="@($"cp {ClassName}")"> @display_name</Th>;
}

@if (!is_loading)
{
    <PageContainer is_container="false">
        <PageHeader is_subpage="true">
            <HeaderLeft>
                <PageTitle ShowFilter="false">
                    <HeaderTemplate>
                     @lang["All Stock Stransfer History"]
                    </HeaderTemplate>
                </PageTitle>
            </HeaderLeft>
            <HeaderRight>
                <RefreshButton OnClick="@(async()=>await LoadData())" />
                <MudHidden Breakpoint="Breakpoint.SmAndDown">
                    <ComSearch place_holder="@GetFilterValue2(state.filters, "keyword","")" KeywordChanged="@OnSearch" show_advance_filter="true" OnFillterClick="@FilterClick">
                        <FilterDateRange @bind-dates="@state.date_range" />
                        <div class="uk-form-controls control-advince-filter-group">
                            <label class="uk-form-label uk-text-bold">@lang["From Stock"]</label>
                            <SelectBusinessBranchMutiple selected_business="@state.multi_select_id_1" selected_businessChanged="@((val)=> { state.multi_select_id_1 = val;state.multi_select_id_2= null;  } )" business_id="@((val)=>state.multi_select_value_1=val)" />
                            <SelectStockLocationMultiple business_branch_ids="@state.multi_select_value_1" @bind-selected_stock_location="@state.multi_select_id_2" stock_location_id="@((val)=>state.multi_select_value_2=val)" />
                        </div>
                        <div class="uk-form-controls control-advince-filter-group">
                            <label class="uk-form-label uk-text-bold">@lang["To Stock"]</label>
                            <SelectBusinessBranchMutiple selected_business="@state.multi_select_id_3" selected_businessChanged="@((val)=> { state.multi_select_id_3 = val;state.multi_select_id_4= null;  } )" business_id="@((val)=>state.multi_select_value_3=val)" />
                            <SelectStockLocationMultiple business_branch_ids="@state.multi_select_value_3" @bind-selected_stock_location="@state.multi_select_id_4" stock_location_id="@((val)=>state.multi_select_value_4=val)" />

                        </div>
                    </ComSearch>
                </MudHidden>
            </HeaderRight>
        </PageHeader>
        <PageBody>
            <MudHidden Breakpoint="Breakpoint.MdAndUp">
                <ComSearch is_fullwidth="true" place_holder="@GetFilterValue2(state.filters, "keyword","")" KeywordChanged="@OnSearch" show_advance_filter="true" OnFillterClick="@FilterClick">
                    <FilterDateRange @bind-dates="@state.date_range" />
                    <div class="uk-form-controls control-advince-filter-group">
                        <label class="uk-form-label uk-text-bold">@lang["From Stock"]</label>
                        <SelectBusinessBranchMutiple selected_business="@state.multi_select_id_1" selected_businessChanged="@((val)=> { state.multi_select_id_1 = val;state.multi_select_id_2= null;  } )" business_id="@((val)=>state.multi_select_value_1=val)" />
                        <SelectStockLocationMultiple business_branch_ids="@state.multi_select_value_1" @bind-selected_stock_location="@state.multi_select_id_2" stock_location_id="@((val)=>state.multi_select_value_2=val)" />
                    </div>
                    <div class="uk-form-controls control-advince-filter-group">
                        <label class="uk-form-label uk-text-bold">@lang["To Stock"]</label>
                        <SelectBusinessBranchMutiple selected_business="@state.multi_select_id_3" selected_businessChanged="@((val)=> { state.multi_select_id_3 = val;state.multi_select_id_4= null;  } )" business_id="@((val)=>state.multi_select_value_3=val)" />
                        <SelectStockLocationMultiple business_branch_ids="@state.multi_select_value_3" @bind-selected_stock_location="@state.multi_select_id_4" stock_location_id="@((val)=>state.multi_select_value_4=val)" />

                    </div>
                </ComSearch>
            </MudHidden>
            <FilterInfo filters="@state.filters" OnRemoveFilterClick="@RemoveFilter" OnRemoveAllFilterClick="@RemoveAllFilter" />
            <Com is_visible="@(models != null)">
                <Table Items="@models"
                       PerPage="@state.pager.per_page"
                       TotalItem="@TotalRecord"
                       CurrentPage="@state.pager.current_page"
                       OnPagerChange="@SelectChange"
                       OnPageChange="@ChangePager"
                       isLoading="@is_loading"
                       ShowPager="true"
                       ShowCounter="true"
                       ClassName="uk-table-small uk-table-striped uk-table-hover"
                       ScrollClass="uk-overflow-auto">
                    <TableHeader>
                        @HeaderTemplate("stock_transfer/stock_transfer_date", lang["Stock Transfer Date"], "uk-text-center")
                        @HeaderTemplate("stock_transfer/document_number", lang["Document #"], "uk-text-center")
                        @HeaderTemplate("stock_transfer/referance_number", lang["Referance #"], "uk-text-center") 
                        <ThAuto>
                            <div>@lang["From Business Branch"]</div>
                            <div class="sub-header-table">@lang["Warehouse"]</div>
                        </ThAuto>
                        <ThAuto>
                            <div>@lang["To Business Branch"]</div>
                            <div class="sub-header-table">@lang["Warehouse"]</div>
                        </ThAuto>
                        <ThCenter>@lang["Quantity"]</ThCenter>
                        <ThCenter>@lang["Unit"]</ThCenter>
                        <ThRight>@lang["Price"]</ThRight>
                        <ThRight>@lang["Amount"]</ThRight>
                        <ThCenter>@lang["Created Date"]</ThCenter>
                        <Th>@lang["Created by"]</Th>
                        <ThRight>@lang["Status"]</ThRight>
                        <th class="uk-width-auto"></th>
                    </TableHeader>
                    <RowTemplate Context="p">
                        <TdCenter>@p.stock_transfer.stock_transfer_date.ToString(gv.date_format)</TdCenter>
                        <TdCenter>
                            <ComAuthorize roles="@gv.GetRole("stock_transfer_management")" url="@($"stocktransfer/{p.stock_transfer_id}")">
                                @p.stock_transfer?.document_number
                            </ComAuthorize>
                        </TdCenter>
                        <TdCenter>@p.stock_transfer?.reference_number</TdCenter>
                        <td>
                            <div>@(gv.current_language.language_id == "km-KH"? p.stock_transfer?.from_business_branch?.business_branch_name_kh : p.stock_transfer?.from_business_branch?.business_branch_name_en)</div>
                            <div class="sub-info-row-table">
                                @p.stock_transfer?.from_stock_location?.stock_location_name
                            </div>
                        </td>
                        <td>
                            <div>@(gv.current_language.language_id == "km-KH"? p.stock_transfer?.to_business_branch?.business_branch_name_kh: p.stock_transfer?.to_business_branch?.business_branch_name_en)</div>
                            <div class="sub-info-row-table">
                                @p.stock_transfer?.to_stock_location?.stock_location_name
                            </div>
                        </td>
                        <TdCenter>@p.quantity.ToString(gv.quantity_format)</TdCenter>
                        <TdCenter>@p.unit</TdCenter>
                        <TdRight>@p.cost.ToString(gv.currency_format)</TdRight>
                        <TdRight>@p.total_amount.ToString(gv.currency_format)</TdRight>
                        <TdCenter>
                            @p.created_date.ToString(gv.date_time_format)
                        </TdCenter>
                        <td>
                            @p.created_by
                        </td>
                        <TdRight>
                            <ComStockTransferStatus model="@p.stock_transfer" />
                        </TdRight>
                        <td>
                            <Icon roles="@gv.GetRole("stock_transfer_management")" icon="visibility" OnClick="@(()=> { nav.NavigateTo($"stocktransfer/{p.stock_transfer_id}"); })" />
                        </td>
                    </RowTemplate>
                </Table>
            </Com>
        </PageBody>
    </PageContainer>
}