@page "/permissionoption"
@inherits PageCore
@using System.Text.Json; 

<Loading is_loading="@is_loading" />
@if (!is_loading)
{
    <PageContainer>
        <PageHeader>
            <HeaderLeft>
                <PageTitle ShowFilter="false">
                    <HeaderTemplate>permission_option</HeaderTemplate>
                </PageTitle>

            </HeaderLeft>
            <HeaderRight ShowBackButton="true" />
        </PageHeader>

        <PageBody>
            
            <ComPerMissionOptionTree PermissionOptions="PermissionOptions" is_parent="true" />
        </PageBody>
        
    </PageContainer>
}
@code {
    List<PermissionOptionModel> PermissionOptions = new List<PermissionOptionModel>();
    PermissionOptionModel PermissionOption = new PermissionOptionModel();
     
    string ControllerApi = "PermissionOption";
    string query_string = "?$filter=parent_id eq null&$expand=permission_options($select=parent_id,option_name,id)&$select=parent_id,option_name,id";
    protected override async Task OnInitializedAsync()
    {
        is_loading = true;
        await Task.Delay(500);
        await LoadPermission();
        is_loading = false;
    }

    async Task LoadPermission()
    {
        var resp =await http.ApiGetOData($"{ControllerApi}{query_string}");
        if (resp.IsSuccess)
        {
            PermissionOptions = JsonSerializer.Deserialize<List<PermissionOptionModel>>(resp.Content.ToString());
        }
    }
}
