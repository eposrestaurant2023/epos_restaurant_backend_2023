@*@page "/eknowledgebase"
@page "/eknowledgebase/{id}"
@inherits PageCore
@layout EknowledgeBaseLayout
<Loading is_loading="@(is_loading || is_loading_data)" />
@if (!is_loading)
{
    <PageContainer>
        <PageHeader title="@state.page_title" OnRefresh="OnRefresh">
            <Right>
                <ComSearch search_text="@GetFilterValue2(state.filters, "keyword","")" show_advance_filter="false">
                </ComSearch>
                <AddButton OnClick="@(()=>nav.NavigateTo($"eknowledgebase/new/{id}"))"/>
            </Right>
        </PageHeader>
        <PageBody>
            @if (!string.IsNullOrEmpty(id))
            {
                <Table Items="@eknowledgebase.Where(r=>r.parent_id == Guid.Parse(id)).ToList()"
                        PerPage="@state.pager.per_page"
                        TotalItem="@TotalRecord"
                        CurrentPage="@state.pager.current_page"
                        OnPagerChange="@SelectChange"
                        OnPageChange="@ChangePager"
                        isLoading="@is_loading_data"
                        ShowPager="true"
                        ShowCounter="true"
                        EmptyText="There is no customer record.">
                    <TableHeader>
                        <ThAuto>Title @state.pager.current_page</ThAuto>
                        <ThCenter>Status</ThCenter>
                        <ThCenter></ThCenter>
                    </TableHeader>
                    <RowTemplate Context="e">
                        <td> 
                            <a href="@($"eknowledgebase/edit/{e.id}")">
                                @e.title_kh
                            </a>
                        </td>
                        <TdCenter>
                            <LabelDeleted is_visible="@e.is_deleted"/> 
                        </TdCenter>
                        <TdActions>
                            <TableActionItem icon="@Icons.Material.Filled.Edit" url="@($"eknowledgebase/edit/{e.id}")">Edit</TableActionItem>
                            <TableActionItem icon="@Icons.Material.Filled.Delete" OnClick="@(()=>Delete_Click(e.id))" is_visible="@(!e.is_deleted)">Delete</TableActionItem>
                            <TableActionItem icon="@Icons.Material.Filled.Delete" OnClick="@(()=>Delete_Click(e.id))" is_visible="@e.is_deleted">Restore</TableActionItem>
                        </TdActions>
                    </RowTemplate>
                </Table>
            }
        </PageBody>
    </PageContainer>

}

@if (is_loading)
{
    <Spinner/>
}
else { 
    <ComKnowledgeBase parent_id="@id" />    
}


@code{
    [Parameter] public Guid id { get; set; }

    async Task OnMenuClick(eKnowledgeBaseModel m)
    {
        nav.NavigateTo($"eknowledgebase/{m.id}");
        
        is_loading = true;
        await Task.Delay(100);
        is_loading = false;
    }
}*@