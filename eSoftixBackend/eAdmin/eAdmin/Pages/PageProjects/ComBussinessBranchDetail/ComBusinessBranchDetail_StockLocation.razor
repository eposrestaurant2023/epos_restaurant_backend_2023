 @inject IDialogService Dialog;
<UIPanel Title="Warehouse">
    <UIPanelHeaderRight>
        <MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="@AddNewStockLocation"/>
    </UIPanelHeaderRight> 
    <UIPanelBody>
        @if (stock_locations != null && stock_locations.Count() > 0)
                {

        <MudGrid>

            @foreach (var d in stock_locations)
            {
                <MudItem xs="12" sm="12" md="6">
                    <MudCard>
                        <MudCardHeader>
                            <CardHeaderAvatar>
                                <MudIcon Icon="@Icons.Material.Filled.Home" />
                            </CardHeaderAvatar>
                            <CardHeaderContent>
                                <div class="d-flex align-center">
                                    <div>
                                        <MudText Typo="Typo.body1">@d.stock_location_name</MudText>
                                    </div>
                                    <div>
                                        <LabelDeleted is_visible="@d.is_deleted"/>
                                        <LabelDefault is_visible="@d.is_default"/>
                                    </div>
                                </div>
                            </CardHeaderContent>
                            <CardHeaderActions>
                                <MenuButton icon="@Icons.Material.Filled.MoreVert" is_loading="@d.is_loading">
                                    <MudMenuItem  roles="@gv.GetRole("project_edit")"  icon="@Icons.Material.Filled.Edit" OnClick="@(()=>EditStockLocation_Click(d))">Edit</MudMenuItem>
                                    <MenuButtonItem roles="@gv.GetRole("project_delete")" icon="@Icons.Material.Filled.Delete" is_visible="@(!d.is_deleted)" OnClick="@(()=>DeleteStockLocation_Click(d))">Delete</MenuButtonItem>
                                    <MenuButtonItem roles="@gv.GetRole("project_restore")" icon="@Icons.Material.Filled.Refresh" is_visible="@(d.is_deleted)" OnClick="@(()=>DeleteStockLocation_Click(d))">Restore</MenuButtonItem>
                                </MenuButton>
                            </CardHeaderActions>
                        </MudCardHeader>

                    </MudCard>
                </MudItem>

            }

        </MudGrid>
        }else
        {
            <MudText Typo="Typo.subtitle1" Align="MudBlazor.Align.Center">There is no stock location in this Branch.</MudText>
        }
    </UIPanelBody>
</UIPanel>
 

@code {
    
    [Parameter] public List<StockLocationModel> stock_locations { get; set; }
    [Parameter] public BusinessBranchModel business_branch { get; set; }
    [CascadingParameter] public AppState gv { get; set; }

     async Task AddNewStockLocation()
    {
           
        var parameters = new DialogParameters { ["model"]=new StockLocationModel(){ business_branch_id = business_branch.id }};
        var dialog = Dialog.Show<ComBusinessBranchDetail_AddStockLocation>("Add New Stock Location",parameters);
        var result = await dialog.Result;

        if (!result.Cancelled)
        {
            stock_locations.Add((StockLocationModel)result.Data);
        }
    }

    async Task EditStockLocation_Click(StockLocationModel stock_location){
        await Task.Delay(100);
    }
    async Task DeleteStockLocation_Click(StockLocationModel stock_location){
        await Task.Delay(100);
    }

     
}

