@inject IHttpService http
@inherits PageCore
@if(projects.Any()){
    <UIPanel Title="Current Project">
    <UIPanelBody>
        <MudList  Clickable="true">
            @foreach (var p in projects)
            {
                <MudListItem>
                    <MudGrid>
                        <MudItem xs="2" md="1" lg="1">
                            <MudAvatar Color="(MudBlazor.Color)p.project_type.color">
                                <MudIcon Icon="@p.project_type.icon"/>
                            </MudAvatar>
                        </MudItem>
                        <MudItem xs="5" lg="5">
                            <MudText Typo="Typo.body1">
                                <MudLink Href="@($"project/{p.id}")" Underline="Underline.None">
                                    @p.project_code - @p.project_name
                                </MudLink>
                            </MudText>
                            <MudText Typo="@Typo.caption">
                                @p.note
                            </MudText>
                        </MudItem>
                        <MudItem xs="5" lg="6">
                            <MudText Typo="Typo.caption">
                                Start : @p.start_date.Value.ToString(gv.date_format)
                            </MudText>
                        </MudItem>
                    </MudGrid>
                </MudListItem>  
            }
        </MudList>  
    </UIPanelBody>
</UIPanel>
}




@code{
    [Parameter] public string id { get; set; }
    List<ProjectModel> projects { get; set; } = new List<ProjectModel>();
    protected override async Task OnInitializedAsync()
    {
        is_loading=true;
        var res = await http.ApiGetOData($"project?$filter=is_closed eq false and is_paid eq false and customer_id eq {id}&$expand=project_type($select=id,icon,color)");
        if (res.IsSuccess)
        {
            projects = JsonSerializer.Deserialize<List<ProjectModel>>(res.Content.ToString());
        } 
        is_loading=false;
    }
}