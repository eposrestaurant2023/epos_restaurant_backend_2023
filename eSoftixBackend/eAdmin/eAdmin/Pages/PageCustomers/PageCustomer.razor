@page "/customer"
@inherits PageCustomerBase;
<Loading is_loading="@(is_loading || is_loading_data)" />


@{
    RenderFragment HeaderTemplate(string field_name, string display_name, string ClassName = "") =>
    @<Th OnClick="@(async () => await OrderBy(field_name))" OrderBy="@(state.pager.order_by == field_name)" OrderByType="@state.pager.order_by_type" ClassName="@($"cp {ClassName}")"> @display_name</Th>;
}
@if (!is_loading)
{


  
<PageContainer>
    <PageHeader title="@state.page_title" >
        <Filter>
            <ModuleView module_views="@gv.GetModuleView("page_customer")" OnClick="@ViewClick" />
        </Filter>
        <Right>
           
            <ComSearch place_holder="@GetFilterValue2(state.filters, "keyword","")" KeywordChanged="@OnSearch" show_advance_filter="true" OnFillterClick="@FilterClick">
                 <FilterDateRange @bind-dates="@state.date_range"  />
                <SelectCustomerGroup @bind-customer_group="@state.customer_group"  show_empty="true" empty_text="All Customer Group" />
            </ComSearch>
             <MudHidden Breakpoint="Breakpoint.SmAndDown">
                <AddButton roles="@gv.GetRole("customer_add")" OnClick="@(()=>nav.NavigateTo("customer/new"))">New</AddButton>
             </MudHidden>
          
        </Right>
    </PageHeader>
    <PageBody>

       <FilterInfo filters="@state.filters" OnRemoveFilterClick="@RemoveFilter" OnRemoveAllFilterClick="@RemoveAllFilter" />


        <Table Items="@customers"
                PerPage="@state.pager.per_page"
                TotalItem="@TotalRecord"
                CurrentPage="@state.pager.current_page"
                OnPagerChange="@SelectChange"
                OnPageChange="@ChangePager"
                isLoading="@is_loading_data"
                ShowPager="true"
                ShowCounter="true"
                EmptyText="There is no customer record.">
            <TableHeader>
                <ThAuto>Customer</ThAuto>
                @HeaderTemplate("gender", "Gender" , "text-center") 
                @HeaderTemplate("customer_group/customer_group_name_en", "Group","text-center")
                @HeaderTemplate("company_name", "Company")
                <ThCenter>
                     <span>Phone1</span>
                    <br />
                    <span>Phone2</span>
                </ThCenter>
                 @HeaderTemplate("current_balance", "Balance" ,"text-center")
                <ThCenter Width="188px">
                    <span>Pendding Project</span>
                    <br />
                    <span>Project</span>
                </ThCenter>
                <ThCenter width="150px">
                    Expired Date
                </ThCenter>
                 <ThCenter width="150px">
                   Register Date
                </ThCenter>
                <Th>
                    Status
                </Th>
                <ThCenter></ThCenter>
            </TableHeader>
            <RowTemplate Context="p">
                <TdCenter>
                  <ComCustomerCodeName customer="@p"/>
                </TdCenter>
                 <TdCenter>
                    @p.gender
                </TdCenter>
                <td>
                    @p.customer_group?.customer_group_name_en
                </td>
                <td>
                    @p.company_name
                </td>
                <TdCenter>
                    <MudText Typo="Typo.body2">@p.phone_1</MudText>
                    <MudText Typo="Typo.body2">@p.phone_2</MudText>
                </TdCenter>
               <TdCenter>
                   @p.current_balance
               </TdCenter>
               <TdCenter>
                    <MudText Typo="Typo.body2">@p.pending_project</MudText>
                    <MudText Typo="Typo.body2">@p.total_project</MudText>
                   
               </TdCenter>
               <TdCenter>
                   @p.expired_date.ToString(gv.date_format)
                   
               </TdCenter>
                <TdCenter>
                   @p.created_date.ToString(gv.date_format)
               </TdCenter>
                <TdCenter>
                    <LabelDeleted is_visible="@p.is_deleted"/>
                   <LabelActive is_visible="@(p.status == true && p.is_deleting == false )"/>
                   <LabelInActive is_visible ="@(p.status == false && p.is_deleting == true )"/>
                </TdCenter>
                <TdActions>
                            <TableActionItem roles="@gv.GetRole("customer_view")" icon="visibility" is_visible="@(!p.is_deleted)" url="@($"customer/{p.id}")">View</TableActionItem>
                            <TableActionItem roles="@gv.GetRole("customer_edit")" icon="edit" is_visible="@(!p.is_deleted)" OnClick="@(()=>OnEdit(p.id))">Edit</TableActionItem>
                            <TableActionItem roles="@gv.GetRole("customer_add")" icon="file_copy" OnClick="@(()=>Clone_Click(p.id))">Clone</TableActionItem>
                            <TableActionItem roles="@gv.GetRole("customer_edit")" icon="highlight_off" is_visible="@(p.status && !p.is_deleted)" OnClick="@(()=>OnToogleStatus(p))">Inactive</TableActionItem>
                            <TableActionItem roles="@gv.GetRole("customer_edit")" icon="check" is_visible="@(!p.status && !p.is_deleted)" OnClick="@(() => OnToogleStatus(p))">Active</TableActionItem>
                            <TableActionItem roles="@gv.GetRole("customer_delete")" icon="delete" is_visible="@(!p.is_deleted)" OnClick="@(() => OnDelete(p))">Delete</TableActionItem>
                            <TableActionItem roles="@gv.GetRole("customer_restore")" icon="refresh" is_visible="@(p.is_deleted)" OnClick="@(()=>OnRestore(p))">Restore</TableActionItem>
                  </TdActions>

            </RowTemplate>
        </Table>
    </PageBody>
</PageContainer>
<MudHidden Breakpoint="Breakpoint.MdAndUp">
    <MudFab Color="MudBlazor.Color.Primary" Icon="@Icons.Material.Filled.Add" Style="position:fixed; bottom:25px;right:5px;" />    
</MudHidden>

}
