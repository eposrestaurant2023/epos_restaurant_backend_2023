@page "/customer/{id:int}"
@inherits PageCustomerDetails

<Loading is_loading="@(is_loading || is_loading_data)" />
@if (!is_loading && !is_error)
{

    <Title Value="@($"Customer : {model.customer_name_en}")"></Title>
    <PageContainer roles="@gv.GetRole("customer_view")">
        <PageHeader>
            <HeaderLeft>
                <PageTitle ShowFilter="false">
                    <HeaderTemplate>
                      @model.customer_code - @model.customer_name_en 
                        <LabelDeleted is_visible="@model.is_deleted" />
                        <LabelActive is_visible="@(!model.is_deleted && model.status)" />
                        <LabelInActive is_visible="@(!model.is_deleted && !model.status)" />
                    </HeaderTemplate>
                </PageTitle>
            </HeaderLeft>
            <HeaderRight ShowBackButton="true">
                <Button icon="edit" title="Edit" OnClick="@(()=>nav.NavigateTo($"customer/edit/{model.id}"))" is_visible="@(!model.is_deleted)" />
                <ComAttachFileButton RoleAdd="@gv.GetRole("customer_add")"
                                     RoleEdit="@gv.GetRole("customer_edit")"
                                     RoleDelete="@gv.GetRole("customer_delete")"
                                     ApiFilter="@($"customer_id eq {id} ")"
                                     File="@(new AttachFilesModel() { customer_id = id })"
                                     IsVisible="@(!model.is_deleted)" />


                <SplitButton roles="@gv.GetRole("customer_add")" alignment="left" url="customer/new" main_button_text="New">
                    <SplitButtonItem roles="@gv.GetRole("customer_add")" url="customer/new">New Customer</SplitButtonItem>
                    <SplitButtonItem roles="@gv.GetRole("customer_add")" url="@($"customer/{model.id}/visit/new")">New Customer Visit</SplitButtonItem>
                    <SplitButtonItem roles="@gv.GetRole("sale_add")" url="@($"sale/customer/{id}")">New Sale Invoice</SplitButtonItem>
                </SplitButton>
                <MoreButton is_loading="@model.is_loading">
                    <MoreButtonItem roles="@gv.GetRole("customer_add")" icon="file_copy" url="@($"customer/clone/{model.id}")">Clone</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_edit")" icon="highlight_off" is_visible="@(!model.is_deleted && model.status)" OnClick="@(() => OnToogleStatus(model))">Inactive</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_edit")" icon="check" is_visible="@(!model.is_deleted && !model.status)" OnClick="@(() => OnToogleStatus(model))">Active</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_delete")" icon="delete" is_visible="@(!model.is_deleted)" OnClick="@(() => OnDelete(model))">Delete</MoreButtonItem>
                    <MoreButtonItem roles="@gv.GetRole("customer_restore")" icon="refresh" is_visible="@(model.is_deleted)" OnClick="@(() => OnRestore(model))">Restore</MoreButtonItem>

                </MoreButton>
                <RefreshButton OnClick="@LoadData" />
            </HeaderRight>
        </PageHeader>
        <PageBody>
            <Tab ClassName="control-header-tab">
                <TabHeader>
                    <TabHeaderItem roles="@gv.GetRole("customer_management")">Overview</TabHeaderItem>
                    <TabHeaderItem OnClick="@(()=> is_comment_loaded = true)">Comments</TabHeaderItem>
                </TabHeader>
                <TabBody>
                    <TabItem>
                        <ComCustomerDetail_CustomerInformation model="@model" />
                    </TabItem>
                    <TabItem>
                        <Com is_visible="@is_comment_loaded">
                            <h3 class="title">
                                Comment
                            </h3>
                            <ComHistory RoleAdd="@gv.GetRole("customer_add")"
                                        RoleDelete="@gv.GetRole("customer_delete")"
                                        RoleEdit="@gv.GetRole("customer_edit")"
                                        ApiFilter="@($"customer_id eq {id}")"
                                        history="@(new HistoryModel() { customer_id = id})"
                                        OnSave="@SaveComment" />
                        </Com>
                    </TabItem>
                </TabBody>
            </Tab>
        </PageBody>
    </PageContainer>

   

    
}
@if (is_error)
{
    <Error title="Customer Detail">
        @error_text
    </Error>
}

