@page "/customer/{id}"
@inherits PageCustomerDetails

@using eAdmin.Pages.PageCustomers.CustomerDetails
<Loading is_loading="@is_loading"/>
    <PageContainer>
        @if(!is_error){
            @if(model != null && !is_loading){
    <PageHeader>
        <Left>
              <MudText Typo="Typo.h6">
            @model.customer_code - @model.customer_name_en (@model.customer_name_kh)
        </MudText>
        @if(model.status == true)
            {
                <MudChip Size="Size.Small" Color="MudBlazor.Color.Primary" Variant="Variant.Filled" Label="true">Active</MudChip>
            }
            else
            {
                <MudChip Size="Size.Small" Color="MudBlazor.Color.Warning" Variant="Variant.Filled" Label="true">InActive</MudChip>
            }
            @if(model.is_deleted==true){
                <MudChip Size="Size.Small" Color="MudBlazor.Color.Error" Variant="Variant.Filled" Label="true">Deleted</MudChip>
            }
        </Left>
        <Right>
            <ComAttachFileButton File="@(new AttachFilesModel(){ customer_id = new Guid(id)})" ApiFilter="@($"customer_id eq {id}")" />
           <MudButtonGroup Color="MudBlazor.Color.Default" Variant="Variant.Filled">
            <MudButton OnClick="@(()=>Navigation_Click("customer/new"))">New</MudButton>
            <MudMenu Icon="@Icons.Material.Filled.ArrowDropDown" Direction="Direction.Bottom" OffsetY="true">
                <MudMenuItem OnClick="@(()=>Navigation_Click("customer/new"))">New Customer</MudMenuItem>
                <MudMenuItem OnClick="@(()=>Navigation_Click($"customer/edit/{model.id}"))">Edit Customer</MudMenuItem>
                <MudMenuItem OnClick="@(()=>Navigation_Click("project/new"))">New Project</MudMenuItem>
           @if(!model.is_deleted){
               @if(model.status){
                 <MudMenuItem OnClick="@(()=>ChangeStatus_Click(model.id))">Inactive</MudMenuItem>    
               }
               else{
                     <MudMenuItem OnClick="@(()=>ChangeStatus_Click(model.id))">Active</MudMenuItem>    
               }
           }
            @if(!model.is_deleted){
                <MudMenuItem OnClick="@DeleteCustomer_Click">Delete Customer</MudMenuItem>
            }
            </MudMenu>
        </MudButtonGroup>
        
        </Right>

    </PageHeader>
    <PageBody>


        <MudTabs Position="@Position.Top"
            ApplyEffectsToContainer="true" Class="mt-8" PanelClass="pa-6">
            <MudTabPanel Text="General Info">
                <ComCustomerDetailGeneralInfo model="@model" is_loading="is_loading"/>
            </MudTabPanel>
            <MudTabPanel Text="Project">
                <ComCustomerProject id="@(new Guid(id))"/>
            </MudTabPanel>
            <MudTabPanel Text="Comment">
                <ComHistory 
                        
                        history="@(new HistoryModel() { customer_id = new Guid(id),user_id = gv.current_login_user.id })"
                        ApiFilter="@($"customer_id eq {id}")"
                        OnSave="@SaveComment" />
            </MudTabPanel>
        </MudTabs>
  
    </PageBody>

}
    }
    else
    {
        <MudText Color="MudBlazor.Color.Warning" Typo="Typo.h5">@error_text</MudText>
    }
</PageContainer>

