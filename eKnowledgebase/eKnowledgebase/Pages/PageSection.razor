@page "/section/{id:guid}"

@inject NavigationManager nav;
@inject eKnowledgebase.Services.eKnowledgebaseService s;
<MudContainer MaxWidth="MaxWidth.Large" Class="cus_a">
    @if (is_loading)
    {
        <div>loading...</div>
    }
    else
    {
        <MudHidden Breakpoint="Breakpoint.MdAndUp">
          <div class="d-flex flex-row align-center">
            <div> <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" /></div>
            <div><div class="view_header_app">
             <h3>@state.GetTitleText(model)</h3>
            </div>
           </div>
        </div>
          <Spacing Number="10"/>
           @foreach (var d in models.OrderBy(r => r.sort_order))
            {
                <div @onclick="@(()=> nav.NavigateTo($"article/{d.id}"))" class="title_aticle">
                    @state.GetTitleText(d)
                </div>
            }
        </MudHidden>
        <MudHidden Breakpoint="Breakpoint.SmAndDown">
            <MudGrid Spacing="5">
                <MudItem md="3">
                      <MudPaper>
                <MudList Clickable="true">
                    <MudListSubheader Class="title_main_topic">
                       Topics
                    </MudListSubheader>
                    @if (model?.parent_id != null)
                    {
                        <NavSectionList id="@model.parent_id" OnItemClick="@OnItemClick" />
                    }
                </MudList>
            </MudPaper>
                </MudItem>
                <MudItem xl="6"  md="4" lg="3">
                     <MudText Typo="Typo.h3"> 
                         @state.GetTitleText(model)
                         
                     </MudText>
                     <Spacing Number="10"/>
                      @foreach (var d in models.OrderBy(r => r.sort_order))
                        {
                            <div @onclick="@(()=> nav.NavigateTo($"article/{d.id}"))" class="title_aticle">
                                @state.GetTitleText(d)
                            </div>
                        }
                </MudItem>
            </MudGrid>
          
        </MudHidden>

      

    }



    <MudDrawer @bind-Open="_drawerOpen" DisableOverlay="false" Variant="@DrawerVariant.Temporary" Elevation="1" ClipMode="DrawerClipMode.Always">
     <PageTitle>@state.GetTitleText(model)</PageTitle>
    @if (is_first_load)
    {
        <div>loading...</div>
    }
    else
    {
         if(model?.parent_id!=null){ 
        <NavSection id="@model.parent_id" OnItemClick="OnItemClick" />
         }
    }
</MudDrawer>
</MudContainer>



@code {
    [CascadingParameter] 
    public AppState state { get; set; }
    [Parameter]
    public Guid id { get; set; }
    List<eKnowledgebaseModel> models = new();
    eKnowledgebaseModel model = new();
    bool is_loading;
    bool _drawerOpen = false;
    bool is_first_load = true;

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }



    protected override async Task OnInitializedAsync()
    {
        is_first_load = false;
        is_loading = true;
        model = await s.GetByID(id);
        models = await s.GetDataByParentID(id);
        is_loading = false;
    }


    async Task OnItemClick(eKnowledgebaseModel m)
    {
       
        model = m;
        id = m.id;
        models = await s.GetDataByParentID(m.id);
        _drawerOpen = false;
        
    }


}